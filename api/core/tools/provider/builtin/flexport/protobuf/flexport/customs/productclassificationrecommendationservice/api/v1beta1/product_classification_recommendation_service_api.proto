// TEAM: customs-insights-ml

syntax = "proto3";

package flexport.customs.productclassificationrecommendationservice.api.v1beta1;

option java_multiple_files = true;
option java_package = "com.flexport.customs.productclassificationrecommendationservice.api.v1beta1";
option ruby_package = "Flexport::Customs::ProductClassificationRecommendationService::Api::V1Beta1";

import "google/rpc/status.proto";

// HTS Classifications service that classifies products with an associated HTS code.
service ProductClassificationRecommendationServiceAPI {
  // For a given product info, multiple HTS code recommendations may be returned which are ordered in descending order from highest prediction_score to lowest
  // A list of product infos returns back a list of lists of HTS code recommendations.
  // For US, the 10 digit HTS code will returned with the dots included (ex: 8542.32.0023)
  // Disclaimer: The recommended HTS codes are not 100% accurate, please reach out to the team if you need to know the accuracy.
  rpc RecommendHtsCodes(RecommendHtsCodesRequest) returns (RecommendHtsCodesResponse);
}

message RecommendHtsCodesRequest {
  // List of product information
  repeated ProductInfo products_info = 1;

  // The max number of HTS recommendations per product info.
  // If max_recommendations is <= 0, the value defaults to 3
  // 0 <= number of recommendations <= max_recommendations
  optional int32 max_recommendations = 2;
}

message RecommendHtsCodesResponse {
  // List of HTS code recommendations
  repeated HtsCodeRecommendations data = 1;
}

message ProductInfo {
  // ISO 3166, ISO ALPHA2 encoding, case insensitive, currently only "US" is supported
  string country_of_import = 1;

  // Natural language description of the product
  string description = 2;

  // The actual product fid that comes from product library db
  string product_fid = 3;
}

message HtsCodeRecommendations {
  // The status of request for the given product info id
  // If status code is not OK (0) then please check the status message as to why a recommendation was not provided
  google.rpc.Status status = 1;

  // List of HTS codes recommendations which can potentially be an empty list.
  repeated HtsCodeRecommendation recommendations = 2;

  // The supplied product fid that came from product library
  string product_fid = 3;
}

message HtsCodeRecommendation {
  // The recommended HTS code
  string hts_code = 1;

  // Represents the likelihood of the associated HTS code
  double prediction_score = 2;
}
