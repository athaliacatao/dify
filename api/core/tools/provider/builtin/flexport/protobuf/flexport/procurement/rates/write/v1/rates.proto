// TEAM: procurement

syntax = "proto3";

package flexport.procurement.rates.write.v1;

import "flexport/procurement/rates/v1/universal_rates.proto";
import "google/protobuf/wrappers.proto";

option java_multiple_files = true;
option java_outer_classname = "RatesProto";
option java_package = "com.flexport.procurement.rates.write.v1";
option ruby_package = "Flexport::Procurement::Rates::Write::V1";

// A collection of rates.
message Rates {
  repeated Rate rates = 1;
}

// A collection of rate items (each rate item is a line item) that all apply together.
message Rate {
  // The fid of the rate to update.
  google.protobuf.StringValue rate_fid = 1;
  repeated BundleReason bundle_reasons = 2;
  repeated RateItem rate_items = 3;
  RateMetaData rate_metadata = 4;
}

// Meta data about a given rate.
message RateMetaData {
  // The source's id of its data, may not be unique for the same rate instance.
  google.protobuf.StringValue source_id = 1;
}

// A reason these rates were bundled together; could be that they share a carrier, or that they only apply to one company etc.
message BundleReason {
  oneof bundle_reason {
    CarrierBundleReason carrier_bundle_reason = 1;
    ServiceLevelBundleReason service_level_bundle_reason = 2;
    FreightPartnerBundleReason freight_partner_bundle_reason = 3;
    NacBundleReason nac_bundle_reason = 4;
    RouteBundleReason route_bundle_reason = 5;
    MasterBillOfLadingBundleReason master_bill_of_lading_bundle_reason = 6;
    ServiceStringBundleReason service_string_bundle_reason = 7;
    CommodityBundleReason commodity_bundle_reason = 8;
    VesselBundleReason vessel_bundle_reason = 9;
    VoyageBundleReason voyage_bundle_reason = 10;
    GoodsClassificationBundleReason goods_classification_bundle_reason = 11;
  }
}

// Specifies the carrier.
message Carrier {
  oneof identifier {
    string carrier_fid = 1;
    string carrier_scac = 2;
  }
}

// Specifies the carrier premium service.
message CarrierPremiumService {
  oneof identifier {
    string carrier_premium_service_fid = 1;
  }
}

// Specifies the client.
message Client {
  oneof identifier {
    string client_fid = 1;
    string client_company_fid = 2;
  }
}

// Specifies the commodity. Not supported for write; this will be supported when commodities are standardized.
message Commodity {}

// Specifies the freight partner.
message FreightPartner {
  oneof identifier {
    string freight_partner_fid = 1;
    string freight_partner_company_fid = 2;
  }
}

// Specifies the shipment.
message Shipment {
  oneof identifier {
    string shipment_fid = 1;
    string shipment_flex_id = 2;
  }
}

// If rates were bundled because of a carrier, this bundle reason is the common carrier.
message CarrierBundleReason {
  Carrier carrier = 1;
}

// If rates were bundled because of a freight partner, this bundle reason is the common freight partner.
message FreightPartnerBundleReason {
  FreightPartner freight_partner = 1;
}

// If rates were bundled because of service level, this bundle reason is the common service level.
message ServiceLevelBundleReason {
  flexport.procurement.rates.v1.Expediency expediency = 1;
  repeated CarrierPremiumService carrier_premium_services = 2 [deprecated = true];
  CarrierPremiumService carrier_premium_service = 3;
}

// If rates were bundled because of a particular client nac, this bundle reason is the common client.
message NacBundleReason {
  Client client = 1;
}

// A rate bundle reason that possible routes are applicable to.
message RouteBundleReason {
  repeated Route possible_routes = 1 [deprecated = true];
  Route route = 2;
}

// A rate bundle reason that BoL numbers are applicable to.
message MasterBillOfLadingBundleReason {
  repeated string bill_numbers = 1 [deprecated = true];
  string bill_number = 2;
}

// A rate bundle reason that service strings are applicable to.
message ServiceStringBundleReason {
  repeated string service_strings = 1 [deprecated = true];
  string service_string = 2;
}

// A rate bundle reason that commodity names are applicable to. Not supported for write; this will be supported when commodities are standardized.
message CommodityBundleReason {
  repeated Commodity commodities = 1 [deprecated = true];
  Commodity commodity = 2;
}

// A rate bundle reason that vessel names are applicable to.
message VesselBundleReason {
  repeated string vessel_names = 1 [deprecated = true];
  string vessel_name = 2;
}

// A rate bundle reason that voyage numbers are applicable to.
message VoyageBundleReason {
  repeated string voyage_numbers = 1 [deprecated = true];
  string voyage_number = 2;
}

// A rate bundle reason that applicability and dangerous goods classification are applicable to.
message GoodsClassificationBundleReason {
  flexport.procurement.rates.v1.GoodsClassificationApplicability applicability = 1;
  // Empty if applicability is NON_DANGEROUS.
  repeated flexport.procurement.rates.v1.DangerousGoodsClassification dangerous_goods_classifications = 2 [deprecated = true];
  // Empty if applicability is NON_DANGEROUS.
  flexport.procurement.rates.v1.DangerousGoodsClassification dangerous_goods_classification = 3;
}

// A rate item that can be used to move cargo.
message RateItem {
  // The fid of the rate item to update.
  google.protobuf.StringValue rate_item_fid = 1;
  repeated Term terms = 2;
  ChargeCode charge_code = 3;
  flexport.procurement.rates.v1.PricingStructure pricing_structure = 4;
  RateItemMetaData rate_item_metadata = 5;
  flexport.procurement.rates.v1.SourceInfo source_info = 6;
}

// A term that defines when a rate is applicable.
message Term {
  oneof term {
    TransportModeTerm transport_mode_term = 1;
    ValidityTerm validity_term = 2;
    CarrierTerm carrier_term = 3;
    FreightPartnerTerm freight_partner_term = 4;
    RouteTerm route_term = 5;
    ClientTerm client_term = 6;
    ContainerTerm container_term = 7;
    CommodityTerm commodity_term = 8;
    ServiceStringTerm service_string_term = 9;
    VesselTerm vessel_term = 10;
    VoyageTerm voyage_term = 11;
    MasterBillOfLadingTerm master_bill_of_lading_term = 12;
    AdditionalLineItemTerm additional_line_item_term = 14;
    ShipmentTerm shipment_term = 15;
    ServiceLevelTerm service_level_term = 16;
    FlightTerm flight_term = 17;
    GoodsClassificationTerm goods_classification_term = 18;
    BupTerm bup_term = 19;
  }
}

// Enum representing the sources with supported charge names.
enum Source {
  SOURCE_INVALID = 0;
  SOURCE_PORTRIX = 1;
  SOURCE_ORIGIN_DESTINATION_PARTNER = 2;
  SOURCE_SHIPCO = 3;
  SOURCE_ECUWORLDWIDE = 4;
  SOURCE_VANGUARD = 5;
  SOURCE_AIR_MAIN_FREIGHT = 6;
  SOURCE_PROCUREMENT_PARSING_SERVICE = 7;
  SOURCE_PROCUREMENT_PARSING_SYSTEM = 8;
  SOURCE_AMASS = 9;
}

// Specifies a charge code.
message ChargeCode {
  // Specifies the source charge identifier to look up the service item template.
  message SourceChargeCodeIdentifier {
    Source source = 1;
    string charge_name = 2;
  }
  oneof identifier {
    string service_item_template_fid = 1;
    SourceChargeCodeIdentifier source_charge_code_identifier = 2;
  }
}

// Meta data about a given rate item.
message RateItemMetaData {
  flexport.procurement.rates.v1.SourceInfo source_info = 1 [deprecated = true];
  // The source's id of its data, may not be unique for the same rate item instance.
  google.protobuf.StringValue source_id = 2;
  // Also known as "rate_type". Un-standardized string that describes when/where the charge is applied.
  google.protobuf.StringValue applicable_type = 3;
}

// Specifies which transport mode a rate is applicable to.
message TransportModeTerm {
  flexport.procurement.rates.v1.TransportMode transport_mode = 1;
}

// Specifies the date range a rate is valid for.
message ValidityTerm {
  flexport.procurement.rates.v1.Date validity_start = 1;
  flexport.procurement.rates.v1.Date validity_end = 2;
}

// Specifies a carrier a rate applies to.
message CarrierTerm {
  Carrier carrier = 1;
}

// Specifies a freight partner a rate applies for.
message FreightPartnerTerm {
  FreightPartner freight_partner = 1;
}

// Specifies the route cargo must take for a rate to apply.
message RouteTerm {
  Location origin = 1;
  Location destination = 2;
  repeated Route possible_routes = 3 [deprecated = true];
  Route route = 4;
}

// A route that cargo can take.
message Route {
  repeated Location stops = 1;
}

// A location.
message Location {
  Address address = 1;
  flexport.procurement.rates.v1.LocationType location_type = 2;
  // TODO: support other location types without fids (ZIP etc.)
}

// An address.
message Address {
  oneof identifier {
    string address_fid = 1;
    string loc_code = 2;
  }
}

// Specifies a client a rate is applicable for.
message ClientTerm {
  repeated Client clients = 1 [deprecated = true];
  Client client = 2;
}

// Specifies an ISO6346 shipping container a rate applies to.
message ContainerTerm {
  string iso_container_code = 1;
  google.protobuf.DoubleValue gross_weight_in_kg = 2;
}

// Specifies the shipped commodity a rate is applicable for. Not supported for write; this will be supported when commodities are standardized.
message CommodityTerm {
  repeated Commodity commodities = 1 [deprecated = true];
  Commodity commodity = 2;
}

// The valid service strings for the rate.
message ServiceStringTerm {
  repeated string service_strings = 1 [deprecated = true];
  string service_string = 2;
}

// Specifies a vessel a rate is applicable for.
message VesselTerm {
  repeated string vessel_names = 1 [deprecated = true];
  string vessel_name = 2;
}

// Specifies a voyage a rate is applicable for.
message VoyageTerm {
  repeated string voyage_numbers = 1 [deprecated = true];
  string voyage_number = 2;
}

// Specifies a master bill of lading a rate is applicable for.
message MasterBillOfLadingTerm {
  repeated string bill_numbers = 1 [deprecated = true];
  string bill_number = 2;
}

// Specifies a goods classification a rate is applicable for.
message GoodsClassificationTerm {
  flexport.procurement.rates.v1.GoodsClassificationApplicability applicability = 1;
  // Empty if applicability is NON_DANGEROUS.
  repeated flexport.procurement.rates.v1.DangerousGoodsClassification dangerous_goods_classifications = 2 [deprecated = true];
  // Empty if applicability is NON_DANGEROUS.
  flexport.procurement.rates.v1.DangerousGoodsClassification dangerous_goods_classification = 3;
}

// Specifies info about addition line item name this rate is applicable for.
message AdditionalLineItemTerm {
  flexport.procurement.rates.v1.AdditionalLineItemName additional_line_item_name = 1;
}

// Specifies the shipment this rate is applicable for.
message ShipmentTerm {
  Shipment shipment = 1;
}

// Specifies the service level this rate is applicable for.
message ServiceLevelTerm {
  flexport.procurement.rates.v1.Expediency expediency = 1;
  repeated CarrierPremiumService carrier_premium_services = 2 [deprecated = true];
  CarrierPremiumService carrier_premium_service = 3;
}

// Specifies the flights this rate is applicable for.
message FlightTerm {
  repeated string flight_numbers = 1 [deprecated = true];
  repeated string flight_sequence_numbers = 2;
}

// Specifies the bups this rate applies to.
message BupTerm {
  flexport.procurement.rates.v1.BupType bup_type = 1;
}
