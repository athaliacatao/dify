// TEAM: work_management

syntax = "proto3";

package flexport.workitems.entityevent.v1;

import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

option java_multiple_files = true;
option java_outer_classname = "QueueEntryEntityProto";
option java_package = "com.flexport.workitems.entityevent.v1";
option ruby_package = "Flexport::WorkItems::EntityEvent::V1";

// SOA ingestion representation of a Queue Entry. Queue entries are defined in the
// work items service (under work_items/ in the monorepo).
message QueueEntryEntity {
  //
  // Section: Queue Entry Identity
  //
  // Globally unique. Can either be primarily linked to a shipment or a work item
  string topic_fid = 10;

  // Indicates which queue the entry belongs to
  string queue_name = 11;

  //
  // Section: Foreign keys
  //
  // List of work items that exist in this queue entry
  repeated string work_item_ids = 20;

  // Next work item due
  string next_due_work_item_id = 21;

  // Snoozed work items
  repeated string snoozed_work_item_ids = 22;

  // List of other related entities to the current queue entry
  repeated string related_topic_fids = 23;

  //
  // Section: Work item status
  //
  // Total number of work items in the queue entry
  uint32 work_items_count = 30;

  // Number of completed work items
  uint32 completed_work_items_count = 31;

  // Work item type of the next due work item
  string next_due_work_item_type = 32;

  //
  // Section: Timestamps
  //
  // When all work items in the queue entry were complete
  google.protobuf.Timestamp completed_at = 40;

  // When queue entry was created
  google.protobuf.Timestamp created_at = 41;

  // When queue entry was last updated
  google.protobuf.Timestamp updated_at = 42;

  // When the next work item is due
  google.protobuf.Timestamp next_due_work_item_due_at = 43;

  //
  // Section: Detailed queue entry information
  //
  // Data used to populate each column of a queue entry (stored as jsonb)
  google.protobuf.Struct column_data = 50;

  // Filters used to fetch this queue entry
  google.protobuf.Struct filter_data = 51;

  // Filter tags used to optimize filtering
  repeated string filter_tags = 52;

  // Queue entry queryable by this string when using the search bar
  string text_search_data = 53;

  //
  // Section: Misc
  //
  // Revision number
  uint64 revision = 60;
}
