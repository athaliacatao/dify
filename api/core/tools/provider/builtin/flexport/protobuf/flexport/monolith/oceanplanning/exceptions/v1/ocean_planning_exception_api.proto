// TEAM: ocean_planning

syntax = "proto3";

package flexport.monolith.oceanplanning.exceptions.v1;

import "flexport/monolith/oceanplanning/exceptions/v1/ocean_planning_exception_entity.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/wrappers.proto";

option java_multiple_files = true;
option java_outer_classname = "OceanPlanningExceptionApiProto";
option java_package = "com.flexport.monolith.oceanplanning.exceptions.v1";
option ruby_package = "Flexport::Monolith::OceanPlanning::Exceptions::V1";

// APIs for accessing and managing exceptions.
service OceanPlanningExceptionAPI {
  // Resolve shipment cancelled.
  rpc ResolveShipmentCancelledException(ResolveShipmentCancelledExceptionRequest) returns (ResolveShipmentCancelledExceptionResponse);
  // Find active exceptions.
  rpc FindActiveExceptionsForShipmentFidWithExceptionCategory(FindActiveExceptionsForShipmentFidWithExceptionCategoryRequest) returns (FindActiveExceptionsForShipmentFidWithExceptionCategoryResponse);
  // Find all filed exceptions.
  rpc FindExceptionsForShipmentFidWithExceptionCategory(FindExceptionsForShipmentFidWithExceptionCategoryRequest) returns (FindExceptionsForShipmentFidWithExceptionCategoryResponse);
  // Resolve an exception.
  rpc ResolveException(ResolveExceptionRequest) returns (ResolveExceptionResponse);
}

message ResolveShipmentCancelledExceptionRequest {
  string shipment_fid = 1;
  string ocean_planning_exception_fid = 2;
}

// There is no response for this endpoint.
message ResolveShipmentCancelledExceptionResponse {}

message FindActiveExceptionsForShipmentFidWithExceptionCategoryRequest {
  string shipment_fid = 1;
}

message FindExceptionsForShipmentFidWithExceptionCategoryRequest {
  string shipment_fid = 1;
}

message FindActiveExceptionsForShipmentFidWithExceptionCategoryResponse {
  // Encapsulates the category and exception.
  message OceanPlanningExceptionWithCategory {
    OceanPlanningExceptionEntity exception = 1;
    // This category comes from centralized exceptions.
    string exception_category = 2;
    string reported_by_user_fid = 3;
    string message = 4;
    google.protobuf.Struct domain_specific_info = 5 [deprecated = true];
    string reported_by_user_name = 6;
    string domain_specific_info_json = 7;
  }
  repeated OceanPlanningExceptionWithCategory exceptions_with_category = 1;
}

message FindExceptionsForShipmentFidWithExceptionCategoryResponse {
  // Encapsulates the category and exception.
  message OceanPlanningExceptionWithCategory {
    OceanPlanningExceptionEntity exception = 1;
    // This category comes from centralized exceptions.
    string exception_category = 2;
  }
  repeated OceanPlanningExceptionWithCategory exceptions_with_category = 1;
}

message ResolveExceptionRequest {
  string ocean_planning_exception_fid = 1;
  bool post_exception_resolution_message = 2 [deprecated = true];
  google.protobuf.StringValue exception_resolution_message = 3;
}

message ResolveExceptionResponse {}
