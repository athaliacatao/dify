// TEAM: perseus

syntax = "proto3";

package flexport.emailmanager.events.v1beta1;

import "flexport/emailmanager/email/v1beta1/email.proto";
import "google/protobuf/timestamp.proto";

option java_multiple_files = true;
option java_outer_classname = "EmailTrackedProto";
option java_package = "com.flexport.emailmanager.events.v1beta1";
option ruby_package = "Flexport::EmailManager::Events::V1Beta1";

// SendGrid may push email tracking events to us, some of them are interesting.
// So we convert each interesting event to an EmailTracked event on EventLog.
// Currently, only "delivered", "bounced", "blocked" are interesting.
message EmailTracked {
  // Email FID
  string fid = 1;

  // Time when this tracking event happened.
  google.protobuf.Timestamp event_time = 2;

  // Type of the sent email, e.g. asn_auto, send_so_to_shipper.
  string email_type = 3;

  flexport.emailmanager.email.v1beta1.TrackingEventType event_type = 4 [deprecated = true];
  // Tracking is recipient-wise.
  // Even if an email can be sent to multiple recipients, each EmailTracked event only stands for one recipient.
  string recipient_email_address = 5;

  // Useful labels for searching and filtering, e.g. shipment_fid, work_item_fid.
  // The email sending code must add labels to the email.
  map<string, flexport.emailmanager.email.v1beta1.LabelValue> labels = 6;

  // Indicates which list the recipient is in: one of "to", "cc", "bcc"
  flexport.emailmanager.email.v1beta1.RecipientRole recipient_role = 7;

  // Type of the tracking event.
  flexport.emailmanager.email.v1beta1.TrackingEventType tracking_event_type = 8;
}
