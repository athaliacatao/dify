// TEAM: commerce_foundation

syntax = "proto3";

package flexport.dcrs.entityevent.v1beta1;

import "google/protobuf/timestamp.proto";

option java_multiple_files = true;
option java_outer_classname = "DigitalClientRateSheetEntityProto";
option java_package = "com.flexport.dcrs.entityevent.v1beta1";
option ruby_package = "Flexport::Dcrs::EntityEvent::V1Beta1";

// Digital client rate sheet entity.
message DigitalClientRateSheetEntity {
  // Basic Info
  string fid = 1;
  string uuid = 2;
  string status = 3;
  google.protobuf.Timestamp created_at = 4;
  google.protobuf.Timestamp updated_at = 5;
  optional google.protobuf.Timestamp archived_at = 6;
  string requested_by_fid = 7;
  optional string published_by_fid = 8;
  optional string name = 9;
  optional google.protobuf.Timestamp last_exported_at = 10;

  // Request
  string client_fid = 21;
  string origin_port_fid = 22;
  string destination_port_fid = 23;
  string request_note = 24;
  RequestMetadata request_metadata = 25;

  // Other
  repeated ChargeItem charge_items = 31;
  optional string service_level = 32;
  optional string carrier_fid = 33;
  RateSheetMetadata metadata = 34;
  OfferingMetadata offering_metadata = 35;
}

message RequestMetadata {
  optional string service_level = 1;
}

message RateSheetMetadata {
  // Transit time
  optional uint32 transit_time_min_days = 1;
  optional uint32 transit_time_max_days = 2;

  // Effective duration
  optional google.protobuf.Timestamp effective_time = 3;
  optional google.protobuf.Timestamp expiration_time = 4;

  // Addresses
  optional string origin_via_port_fid = 5;
  optional string destination_via_port_fid = 6;
  optional string origin_address_fid = 7;
  optional string destination_address_fid = 8;

  // Others
  optional string ocean_fcl_offering_fid = 9;
  optional bool subject_to_gri = 10;
  optional string dangerous_goods = 11;
  optional string booking_instruction = 12;
  optional string free_text = 13;
  optional uint64 order_template_id = 14;
}

message RateSheetOffering {
  string fid = 1;
  optional google.protobuf.Timestamp selected_date = 2;
  repeated string accessorial_slugs = 3;
  // TODO: Support other options later when used
}
message OfferingMetadata {
  optional RateSheetOffering origin_drayage_offering = 1;
  optional RateSheetOffering destination_drayage_offering = 2;
  optional RateSheetOffering destination_offering = 3;
  optional RateSheetOffering insurance_offering = 4;
}

message ChargeItem {
  oneof type {
    ChargeItemOceanFclBase ocean_fcl_base = 1;
    ChargeItemDetention detention = 2;
    ChargeItemDocument document = 3;
  }
}

// Ocean FCL Base
message ContainerRate {
  optional string twenty_ft = 1;
  optional string forty_ft = 2;
  optional string forty_ft_hc = 3;
  optional string forty_five_ft_hc = 4;
}
message ChargeItemRateOceanFclBase {
  // Buy side
  optional string buy_side_currency = 1;
  ContainerRate buy_side_rate = 2;

  // Sell side
  optional string sell_side_currency = 3;
  ContainerRate sell_side_rate = 4;
  optional string sell_side_margin_policy = 5;
}
message ChargeItemOceanFclBase {
  optional string charge_type_slug = 1;
  string charge_type_category = 2;
  ChargeItemRateOceanFclBase rate = 3;
}

// Detention
message TieringRate {
  optional uint32 start = 1;
  optional string amount = 2;
}
message ChargeItemRateDetention {
  optional string currency = 1;
  optional uint32 free_day = 2;
  repeated TieringRate tiering_rates = 3;
}
message ChargeItemDetention {
  string charge_type_slug = 1;
  string charge_type_category = 2;
  ChargeItemRateDetention rate = 3;
}

// Documents
enum CountRateType {
  COUNT_RATE_TYPE_INVALID = 0;
  COUNT_RATE_TYPE_CONTAINER_COUNT = 1;
  COUNT_RATE_TYPE_BILL_OF_LADING_COUNT = 2;
}
message ChargeItemRateCount {
  optional string currency = 1;
  CountRateType count_rate_type = 2;
  optional string buy_side_rate = 3;
  optional string sell_side_rate = 4;
}
message ChargeItemDocument {
  string charge_type_slug = 1;
  string charge_type_category = 2;
  ChargeItemRateCount rate = 3;
}
