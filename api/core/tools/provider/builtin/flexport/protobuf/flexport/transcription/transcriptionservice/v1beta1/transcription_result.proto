// TEAM: document_intelligence

syntax = "proto3";

package flexport.transcription.transcriptionservice.v1beta1;

option java_multiple_files = true;
option java_outer_classname = "TranscriptionResultProto";
option java_package = "com.flexport.transcription.transcriptionservice.v1beta1";
option ruby_package = "Flexport::Transcription::TranscriptionService::V1Beta1";

import "google/protobuf/wrappers.proto";

// A document transcribed by a service/system.
message TranscribedDocument {
  // Source document fid
  google.protobuf.StringValue source_doc_fid = 1;
  // Document type (mbl, hbl, hawb, pgbl, an).
  google.protobuf.StringValue document_type = 2;
  // Pages of the transcribed document
  repeated TranscribedDocumentPage pages = 3;
  // Annotations capturing content extracted from the document
  repeated TranscribedDocumentAnnotation annotations = 4;
  // Provider task id
  google.protobuf.StringValue provider_task_id = 5;
}

// A page of a transcribed document, generally equivalent to one side of a sheet of paper.
message TranscribedDocumentPage {
  // Width of the document page in pixels
  int32 width = 1;
  // Height of the document page in pixels
  int32 height = 2;
  // URL of an image of the document page described by this message
  google.protobuf.StringValue image_url = 3;
  // Index of the page in the context of the whole document. Necessary to join with annotations in multi-page documents.
  int32 page_index = 4;
}

// An annotation on a transcribed document, representing some text or content extracted from the document.
message TranscribedDocumentAnnotation {
  // Unique identifier for the annotation
  google.protobuf.StringValue id = 1;
  // Page index (0 to N-1)
  int32 page_index = 2;
  // The field name, it will end in `.key` or `.value` for key value pairs.
  google.protobuf.StringValue label = 3;
  // `text` is the parsed text from the document for that annotation, it will include the key text or value text for example
  google.protobuf.StringValue content = 4;
  // Confidence / likelihood of correctness (0 to 1)
  float confidence = 5;
  // Location of the top edge of the bounding box from the top of the page, in pixels
  int32 bounding_box_top = 6;
  // Location of the left edge of the bounding box from the left edge of the page, in pixels
  int32 bounding_box_left = 7;
  // Width of the bounding box, in pixels
  int32 bounding_box_width = 8;
  // Height of the bounding box, in pixels
  int32 bounding_box_height = 9;
  // A list of UUIDs representing directed links to other annotations. Generally, links corresponding key and value annotations.
  repeated google.protobuf.StringValue annotation_references = 10;
}

// The transcription result t2o send to the kinesis stream for recordflow to consume.
message TranscriptionResult {
  string transcription_job_fid = 1;
  oneof file_fid {
    string document_fid = 2;
    string storage_fid = 3;
  }
  // Third party provider to use for transcription.
  enum Provider {
    PROVIDER_INVALID = 0;
    PROVIDER_SCALE = 1;
    PROVIDER_ROSSUM = 2;
  }
  Provider provider = 4;
  bool is_error = 5;
  // Revision number increases if we retranscribe same fid with the same provider.
  int32 revision_number = 6;
  oneof provider_response {
    ScaleAIResult scale_result = 7;
    RossumAIResult rossum_result = 8;
  }
}

// The raw json response we get back from Scale.
message ScaleAIResult {
  // raw json response. can be rich in the future.
  string raw_scale_ai_response = 1;
}

// The raw json response we get back from Rossum.
message RossumAIResult {
  // raw json response. can be rich in the future.
  string raw_rossum_ai_response = 1;
}
