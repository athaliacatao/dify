// TEAM: forwarding_platform

syntax = "proto3";

package flexport.executioncoordinator.executionoffering.v1;

import "flexport/catalog/enums/v1/enums.proto";
import "flexport/executioncoordinator/executionoffering/v1/transit/auxiliary_trucking.proto";
import "flexport/executioncoordinator/executionoffering/v1/transit/common.proto";
import "flexport/executioncoordinator/executionoffering/v1/transit/nra_constraints.proto";
import "flexport/os/v1/types/walltimedate/v1/wall_time_date.proto";
import "google/protobuf/wrappers.proto";

option java_multiple_files = true;
option java_outer_classname = "OceanNonFclExecutionOfferingProto";
option java_package = "com.flexport.executioncoordinator.executionoffering.v1";
option ruby_package = "Flexport::ExecutionCoordinator::ExecutionOffering::V1";

// An ExecutionOffering for cargo to be consolidated and moved via ocean freight.
//
// Why is this called `OceanNonFcl` instead of `OceanLcl`?
//
// The term "ocean LCL" is overloaded to mean two things:
//
// 1. A shape of cargo: literally, "less than a full container load".
// 2. A specific ocean consolidation execution strategy: CFS-to-CFS movement of a container
//    with cargo from several shipments bound for different destinations and consignees.
//
// This distinction is important because there are other possible ocean consolidation execution
// strategies. Namely, a non-FCL ocean shipment could be fulfilled with either buyer's consol
// or OceanMatch, neither of which are strictly considered "ocean LCL":
//
// https://tw.kuehne-nagel.com/en_gb/seafreight/buyers-consolidation-load-bcl/
// https://www.flexport.com/services/ocean-shipping/oceanmatch/
//
// Using this offering, it possible to define #1 (the cargo shape) without prescribing #2 (the
// execution strategy). This reflects on-the-ground business operations. For high-volume clients,
// a different consolidation strategy could be selected on a week-by-week based on how much
// volume is expected at an origin CFS:
//
// https://docs.google.com/presentation/d/1RwizpXZAGhHn_bq6HMnkDqz9-C9kyxVGxlIdew5Migo
//
// In these cases, shippers place non-FCL ocean bookings and the execution strategy is decided
// by the buy-side. In other cases, the sell-side may prescribe a specific execution strategy
// within this offering based on customer preferences.
//
// If we were starting anew as a consolidations-first freight service provider, we could eschew
// the term "non-FCL" and just call it "Ocean ExecutionOffering" to match the spiritually similar
// "Air ExecutionOffering". "OceanFcl" would be an the exceptional case. This is how other
// co-loaders and a few other freight forwarders seem to operate. But because our business started
// with ocean FCL, the term "ocean" alone is too ambiguous, so we need to qualify it.
//
// Hope that makes sense! Thanks for reading! More details on go/execution-offering wiki.
//
message OceanNonFclExecutionOffering {
  // See go/pickups-and-deliveries wiki.
  repeated AuxiliaryTruckingPickup pickups = 12;
  repeated AuxiliaryTruckingDelivery deliveries = 13;

  // See go/transloading wiki.
  repeated AuxiliaryOriginTransloadingTrucking origin_transloading_truckings = 16;
  repeated AuxiliaryDestinationTransloadingTrucking destination_transloading_truckings = 17;

  oneof carrier {
    SpecificCarrier specific_carrier = 7;
    OpenCarrier open_carrier = 8;
  }
  oneof route {
    OceanNonFclSpecificRoute specific_route = 9;
    OpenRoute open_route = 10;
  }
  string freight_partner_fid = 11;
  OceanNonFclTransitTime quoted_transit_time = 14;
  OceanNonFcLOteMilestones ote_milestones = 24;
  //
  // OceanMatch is a non-FCL execution strategy offered by Flexport wherein a customer who would
  // otherwise ship a partially full FCL container allows Flexport to put in other consignees' LCL
  // cargo into the container as well (in exchange for a cheaper rate on the container). This
  // boolean indicates a shipment for which the customer has offered up their container for the
  // OceanMatch program. The other consignees' ExecutionOrders are just normal OceanNonFcl orders,
  // and the decision to use OceanMatch vs internal LCL vs co-loader (eg Shipco) is made during
  // buy-side planning.
  google.protobuf.BoolValue is_ocean_match = 15;
  //
  // Flow Direct is creating a consolidated container for clients shipping from China to the same
  // e-commerce Distribution Center in the US.  By consolidating shipments at origin based on their
  // final door destination, we can skip the de-consolidation step in traditional LCL,
  // improving transit time and reducing cost.
  // Reference: https://flexport.atlassian.net/wiki/spaces/GCN/pages/2195656799/Flow+Direct
  google.protobuf.BoolValue is_flow_direct = 19;
  //
  // Global Conveyor Belt is a subset of an ocean LCL shipment. The difference is that all the freight
  // offerings are stitched together, for example a single door to door global conveyor belt offering
  // will consist of origin cartage, lcl, and destination cartage.
  google.protobuf.BoolValue is_global_conveyor_belt = 20;
  //
  // Buyers consol is a subset of ocean LCL shipment. The difference is that all the child shipments have the
  // same client id, here we will use a tricky logic to indicate if it is a buyers consol shipment.
  // for any master shipment, it would check if it has been quoted to buyers consol shipment
  // for any child/demand shipment, it would check if the LCL - Ocean Freight is zero from quoting
  google.protobuf.BoolValue is_buyers_consolidation = 21;
  //
  // The main freight role describes how Flexport intermediates the relationship between the
  // client and the co-loader or external ocean carrier for the shipment. The "full service" role
  // means we execute on either our own ocean carrier contract or a Flexport-owned co-loader
  // contract eg with Shipco.
  OceanNonFclRole main_freight_role = 1;
  //
  // Info related to the main freight role.
  oneof role_related_info {
    OceanNonFclFullServiceInfo full_service_info = 2;
  }
  //
  // The service level associated with a Flexport ocean non-fcl shipment.
  // Current service levels offered for ocean no-fcl are standard, express, and deferred.
  // For reference: https://flexport.atlassian.net/wiki/spaces/KB/pages/2514125743/Ocean+FCL+FAK+Commercial+Service+Levels
  string main_freight_service_level = 18;
  ServiceLevel main_freight_service_level_enum = 22;
  flexport.catalog.enums.v1.OceanTierDto catalog_tier = 23;
}

// Info specific to ocean non-FCL shipments with the "full service" main freight role.
message OceanNonFclFullServiceInfo {
  //
  // The service boundary to appear on the House Bill of Lading. As of October 2020, this is
  // almost always CFS-to-CFS, even if the broader shipment is door-to-door.
  // Required.
  OceanNonFclBoundary hbl_boundary = 1;
  //
  // The constraints on the Negotiated Rate Agreement (NRA) define the terms of the ocean freight
  // rate offered by Flexport as NVOCC.
  // Required if shipment is to or from USA. Must be empty otherwise.
  NraConstraints nra_constraints = 2;
}

// Transit time for an ocean non-FCL shipment.
message OceanNonFclTransitTime {
  int32 min_days = 2;
  int32 max_days = 3;
  OceanNonFclTransitTimeStart start = 4;
  OceanNonFclTransitTimeEnd end = 5;
  flexport.os.v1.types.walltimedate.v1.WallTimeDate based_on_start_date = 6;
  // The IANA timezone identifier for the quoted destination location.
  string destination_timezone = 7;
  int32 origin_days = 8;
  int32 consolidation_days = 9;
  int32 origin_dwell_days = 10;
  int32 port_to_port_days = 11;
  int32 destination_dwell_days = 12;
  int32 deconsolidation_days = 13;
  int32 destination_days = 14;
}

// On time execution metrics for an ocean non-FCL shipment. The numbers are in days.
message OceanNonFcLOteMilestones {
  float door_to_cfs_or_port = 1;
  float consolidation_processing = 9;
  float delivery_to_port = 2;
  float origin_ingate_departure = 3;
  float port_to_port = 4;
  float dest_arrival_avail_unload = 5;
  float port_recovery = 6;
  float deconsolidation_processing = 7;
  float cfs_or_port_to_door = 8;
}

// Start event for transit time for an ocean non-FCL shipment.
enum OceanNonFclTransitTimeStart {
  OCEAN_NON_FCL_TRANSIT_TIME_START_INVALID = 0;
  // For door-to-*.
  OCEAN_NON_FCL_TRANSIT_TIME_START_DOOR_CARGO_READY = 1;
  // For cfs-to-*.
  OCEAN_NON_FCL_TRANSIT_TIME_START_CFS_ARRIVAL = 2;
  // Not currently supported, but for sellers consolidation cy-to-*, could also include:
  // OCEAN_NON_FCL_TRANSIT_TIME_START_CY_ARRIVAL
}

// End event for transit time for an ocean non-FCL shipment.
enum OceanNonFclTransitTimeEnd {
  OCEAN_NON_FCL_TRANSIT_TIME_END_INVALID = 0;
  // For *-to-door.
  OCEAN_NON_FCL_TRANSIT_TIME_END_DOOR_ARRIVAL = 1;
  // For *-to-cfs.
  OCEAN_NON_FCL_TRANSIT_TIME_END_CFS_AVAILABLE_FOR_PICKUP = 2;
  // Not currently supported, but for buyers consolidation to *-to-cy, could also include:
  // OCEAN_NON_FCL_TRANSIT_TIME_END_CY_AVAILABLE_FOR_PICKUP
}

// A specific ocean consol route.
message OceanNonFclSpecificRoute {
  string origin_cfs_fid = 1;
  string port_of_loading_fid = 2;
  repeated string via_port_fids = 3;
  string port_of_unloading_fid = 4;
  string inland_port_fid = 5;
  string destination_cfs_fid = 6;
  string inland_cfs_fid = 7;
}

// The role Flexport has in ocean non-FCL main freight movement.
//
// As of October 2020, Flexport non-FCL services are almost always full service
// and there is no product support for anything else. Similar to the OceanFclRole, the non-FCL roles
// are defined in a country-agnostic way but are heavily inspired by the USA's FMC.
enum OceanNonFclRole {
  OCEAN_NON_FCL_ROLE_INVALID = 0;
  //
  // Flexport coordinates ocean movement on a Flexport-arranged external carrier contract. For
  // shipments to/from the USA, this corresponds to the "non-vessel owning common carrier" (NVOCC)
  // FMC role. An NVOCC is permitted to issue a House Bill of Lading (HBL) and to mark up ocean
  // freight rates with clients in the US. An NVOCC is considered an ocean carrier and is
  // responsible for the freight per the service boundary listed on their HBL.
  OCEAN_NON_FCL_ROLE_FULL_SERVICE = 1;
  //
  // Flexport not involved in the main freight ocean FCL segment of the shipment.
  // "Visibility-only" shipments should have this role.
  OCEAN_NON_FCL_ROLE_NO_INVOLVEMENT = 4;
}

// Boundaries of a non-FCL ocean service.
enum OceanNonFclBoundary {
  OCEAN_NON_FCL_BOUNDARY_INVALID = 0;
  OCEAN_NON_FCL_BOUNDARY_CFS_TO_CFS = 1;
  OCEAN_NON_FCL_BOUNDARY_CFS_TO_CY = 2;
  OCEAN_NON_FCL_BOUNDARY_CFS_TO_DOOR = 3;
  OCEAN_NON_FCL_BOUNDARY_CY_TO_CFS = 4;
  OCEAN_NON_FCL_BOUNDARY_CY_TO_CY = 5;
  OCEAN_NON_FCL_BOUNDARY_CY_TO_DOOR = 6;
  OCEAN_NON_FCL_BOUNDARY_DOOR_TO_CFS = 7;
  OCEAN_NON_FCL_BOUNDARY_DOOR_TO_CY = 8;
  OCEAN_NON_FCL_BOUNDARY_DOOR_TO_DOOR = 9;
}
