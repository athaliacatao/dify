// TEAM: perseus

syntax = "proto3";

package flexport.emailmanager.email.v1beta1;

import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";

option java_multiple_files = true;
option java_outer_classname = "EmailProto";
option java_package = "com.flexport.emailmanager.email.v1beta1";
option ruby_package = "Flexport::EmailManager::Email::V1Beta1";

// Main DTO of a saved email
message Email {
  // identifier
  string fid = 1;
  // email sent or received time
  google.protobuf.Timestamp created_time = 2;
  // time when it is received by SendGrid server (not necessarily received by recipients)
  // should also have a processed_time for inbound?
  google.protobuf.Timestamp sent_time = 3;

  // email type name
  string email_type = 4;
  // title
  string subject = 5;
  // null by default, set include_body=true when querying to include it
  google.protobuf.StringValue body = 6;
  // sender's email contact dto
  EmailContact from_contact = 7;
  // a system email from no-reply address can declare a reply-to address
  EmailContact reply_to_contact = 8;
  // “to” recipients' email contact info
  repeated EmailContact to_contacts = 9;
  // “cc” recipients' email contact info
  repeated EmailContact cc_contacts = 10;
  // “bcc” recipients' email contact info
  repeated EmailContact bcc_contacts = 11;
  // Is email inbound or outbound
  bool is_outbound = 12;
  // searchable key-values associated with this email, e.g. shipment_fid, work_item_fid. (max_size=10, i.e. you can pass in 10 labels at most)
  map<string, LabelValue> labels = 13;
  // metadata only, real files are stored in S3
  repeated Attachment attachments = 14;
  // domain-arbitrary string, email platform does not understand it, but the API callers do.
  string context = 15;
  // fid of the user who send this email, only valid for outbound email
  string created_by_fid = 16;
  repeated TrackingEvent tracking_events = 17;

  // null by default, set include_plain_body=true when querying to include it
  google.protobuf.StringValue plain_text_body = 18;
}

// Polymorphic value of a label
message LabelValue {
  oneof kind {
    string string_value = 1;
  }
}

// Metadata of an attached file, it may have either file_object_fid or document_fid, check these fields on your own.
message Attachment {
  // displayed file name
  string name = 1;
  // Non-empty if stored in Storage Service. Please see FileObjectsAPI.
  string file_object_fid = 2;
  // Non-empty if stored in Monolith Document. Please see MonolithDocumentsAPI.
  string document_fid = 3;
}

// Metadata for email address
message EmailContact {
  string email_address = 1;
  // optional
  string name = 2;
  // optional
  string user_fid = 3;
}

// A factual view, the source-of-truth of each email activity update.
message TrackingEvent {
  // identifier of the email that owns this event
  string email_fid = 1;
  // identifier of the recipient that correlates to this event
  string recipient_email_address = 2;
  // type of the tracking event
  TrackingEventType event_type = 3;
  // time when this event happened
  google.protobuf.Timestamp event_time = 4;
}

enum TrackingEventType {
  TRACKING_EVENT_TYPE_INVALID = 0; // protobuf reserved zero-value
  TRACKING_EVENT_TYPE_PROCESSED = 1;
  TRACKING_EVENT_TYPE_DROPPED = 2;
  TRACKING_EVENT_TYPE_DELIVERED = 3;
  TRACKING_EVENT_TYPE_BOUNCED = 4;
  TRACKING_EVENT_TYPE_BLOCKED = 5;
  TRACKING_EVENT_TYPE_DEFERRED = 6;
  TRACKING_EVENT_TYPE_OPENED = 7;
}

enum RecipientRole {
  RECIPIENT_ROLE_INVALID = 0; // protobuf reserved zero-value
  RECIPIENT_ROLE_TO = 1;
  RECIPIENT_ROLE_CC = 2;
  RECIPIENT_ROLE_BCC = 3;
}
