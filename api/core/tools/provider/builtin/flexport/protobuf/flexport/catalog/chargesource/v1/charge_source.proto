// TEAM: service_catalog

syntax = "proto3";

package flexport.catalog.chargesource.v1;

import "google/protobuf/wrappers.proto";

option java_multiple_files = true;
option java_package = "com.flexport.catalog.chargesource.v1";
option ruby_package = "Flexport::Catalog::ChargeSource::V1";

// A unified structure to represent the source for both cost and markup.
message ChargeSource {
  ChargeSourceType source_type = 1;

  oneof source_details {
    // Set when the cost/markup is from offering
    OfferingChargeSource offering_source = 2;
    // Set when the cost/markup is from rules engine rules
    RulesChargeSource rules_source = 3;
    // Set when the cost/markup is from decision table
    DecisionTableChargeSource decision_table_source = 4;
  }
}

enum ChargeSourceType {
  CHARGE_SOURCE_TYPE_INVALID = 0;
  CHARGE_SOURCE_TYPE_OFFERING = 1;
  CHARGE_SOURCE_TYPE_RULES = 2;
  CHARGE_SOURCE_TYPE_DECISION_TABLE = 3;
  CHARGE_SOURCE_TYPE_DEFAULT = 4;
}

// The creation source of the offering.
enum OfferingSource {
  OFFERING_SOURCE_INVALID = 0;
  OFFERING_SOURCE_RATE_SHEET = 1;
  OFFERING_SOURCE_OFFERING_EDITOR = 2;
}

enum PricingEligibilityType {
  PRICING_ELIGIBILITY_TYPE_INVALID = 0;
  // When the pricing policy is open for all.
  PRICING_ELIGIBILITY_TYPE_DEFAULT = 1;
  // When the price policy is matched by client. (NAC offerings)
  PRICING_ELIGIBILITY_TYPE_CLIENT = 2;
  // When the price policy is matched by segment
  PRICING_ELIGIBILITY_TYPE_SEGMENT = 3;
}

message OfferingChargeSource {
  google.protobuf.StringValue offering_fid = 1;
  OfferingSource source = 2;
  PricingEligibilityType pricing_eligibility_type = 3;
}

message RulesChargeSource {
  // The appplicability rules
  RuleInfo applicability_rule_info = 1;
  // The cost (icc) rules
  RuleInfo cost_rule_info = 2;
  // The markup rules
  RuleInfo markup_rule_info = 3;
}

message RuleInfo {
  // flx::rules_engine:rule:dbid/<rule_dbid>
  google.protobuf.StringValue rule_fid = 1;
  // the branch id hit by the conditions
  google.protobuf.StringValue branch_id = 2;
  // whether the branch is the default branch
  google.protobuf.BoolValue is_default_branch = 3;
}

message DecisionTableChargeSource {
  // flx::rules_engine:decision_table_v2:dbid/<decision_table_dbid>
  google.protobuf.StringValue decision_table_fid = 1;
  // the row index hit by the conditions
  google.protobuf.Int32Value row_index = 2;
}
