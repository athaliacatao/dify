// TEAM: customs_platform

syntax = "proto3";

package flexport.customs.v2writeback.customsplanner.v1beta1;

import "flexport/customs/v2writeback/customsv2writeback/v1beta1/v2_writeback_source.proto";
import "google/protobuf/timestamp.proto";

option ruby_package = "Flexport::Customs::V2Writeback::CustomsPlanner::V1Beta1";

service CustomsV2CustomsPlannerWritebackAPI {
  rpc WritebackRequiredDeclarations(WritebackRequiredDeclarationsRequest) returns (WritebackRequiredDeclarationsResponse);
  rpc UnenrollRequiredDeclarations(UnenrollRequiredDeclarationsRequest) returns (UnenrollRequiredDeclarationsResponse);
}

message RequiredDeclaration {
  // If id is not given, required declaration will be matched on
  // v2_filing_fid / v2_filing_service_fid, or a new one will be created
  // if it doesn't exist.
  int32 id = 1;
  string address_fid = 2;
  string created_by_user_fid = 3;
  string customs_agent_company_entity_fid = 4;
  google.protobuf.Timestamp deleted_at = 5;
  string shipment_fid = 6;
  bool to_be_reviewed = 7;
  RequiredDeclarationType type = 8;
  string updated_by_user_fid = 9;
  // The fids of the corresponding v2 entity
  string v2_filing_fid = 30;
  string v2_filing_service_fid = 31;
  flexport.customs.v2writeback.customsv2writeback.v1beta1.V2WritebackSource source = 32;
  repeated string v2_commercial_invoice_fids = 40;
  // References ShipmentContainerEngine::Container; (container_number) is unique
  repeated string container_numbers = 41;
  // References HouseBillOfLading::BillOfLading; (shipment_id,bill_number) is unique
  repeated string bill_of_lading_numbers = 42;
}

enum RequiredDeclarationType {
  REQUIRED_DECLARATION_TYPE_INVALID = 0;
  REQUIRED_DECLARATION_TYPE_SAD = 1;
  REQUIRED_DECLARATION_TYPE_T1 = 2;
  REQUIRED_DECLARATION_TYPE_US_IMPORT_ENTRY = 3;
  REQUIRED_DECLARATION_TYPE_CA_IMPORT = 4;
  REQUIRED_DECLARATION_TYPE_GENERIC_CUSTOMS_CLEARANCE = 5;
  REQUIRED_DECLARATION_TYPE_FTZ_E214 = 6;
}

message V2ToV1IdMapping {
  repeated RequiredDeclarationMapping required_declaration_mapping = 1;
  message RequiredDeclarationMapping {
    string v1_required_declaration_fid = 1;
    string v2_filing_fid = 2;
    string v2_filing_service_fid = 3;
    // A map with all CIs linked to this required declaration
    // v2 CI fids as keys and v1 CI fid as value.
    map<string, string> ci_v2_fid_to_v1_fid = 10;
  }
}

message WritebackRequiredDeclarationsRequest {
  string shipment_fid = 1;
  // The customs filing order for which this work is performed
  string customs_filing_order_fid = 2;
  // All required declarations for the shipment
  repeated RequiredDeclaration required_declarations = 11;
}

message WritebackRequiredDeclarationsResponse {
  V2ToV1IdMapping id_mapping = 1;
}

message UnenrollRequiredDeclarationsRequest {
  string shipment_fid = 1;
  string customs_filing_order_fid = 2;
}

message UnenrollRequiredDeclarationsResponse {
  V2ToV1IdMapping id_mapping = 1;
}
