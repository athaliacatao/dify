// TEAM: customs_platform

syntax = "proto3";

package flexport.customs.v2writeback.customsdeclarationus.v1beta1;

import "flexport/customs/v2writeback/customsv2writeback/v1beta1/v2_writeback_source.proto";
import "google/protobuf/timestamp.proto";
import "google/type/money.proto";

option ruby_package = "Flexport::Customs::V2Writeback::CustomsDeclarationUs::V1Beta1";

service CustomsV2CustomsDeclarationUsWritebackAPI {
  rpc WritebackCustomsEntries(WritebackCustomsEntriesRequest) returns (WritebackCustomsEntriesResponse);
  rpc UnenrollCustomsEntries(UnenrollCustomsEntriesRequest) returns (UnenrollCustomsEntriesResponse);
}

message CustomsEntry {
  optional google.protobuf.Timestamp cargo_release_at = 1;
  optional google.protobuf.Timestamp cargo_release_date = 2;
  optional CargoReleaseStatus cargo_release_status = 3;
  optional string duty_retrieval_errors = 4; // json list
  optional string entry_number = 5;
  optional EntrySummaryStatus entry_summary_status = 6;
  optional FdaStatus fda_status = 7;
  optional InvoicingStatus invoicing_status = 8;
  optional ManifestStatus manifest_status = 9;
  optional int32 netchb_cursor_value = 10;
  bool one_usg = 11;
  optional ReleaseStatus release_status = 12;
  optional string statement_number = 13;
  optional google.protobuf.Timestamp status_last_queried_at = 14;
  optional google.protobuf.Timestamp status_last_queued_at = 15;
  optional TransmitToNetchbReason transmit_to_netchb_reason = 16;
  optional google.protobuf.Timestamp transmitted_to_customs_at = 17;
  optional google.protobuf.Timestamp transmitted_to_netchb_at = 18;
  optional string declaration_fid = 19;
  string shipment_fid = 20;
  repeated CustomsEntryVersion customs_entry_versions = 21;
  repeated PgaStatus pga_statuses = 22;
  repeated string v2_commercial_invoice_fids = 23;

  // If not provided will be looked up using v2 fid
  repeated string v1_commercial_invoice_fids = 24;

  // The FID of the corresponding V2 entity
  string v2_filing_fid = 50;
  flexport.customs.v2writeback.customsv2writeback.v1beta1.V2WritebackSource source = 51;
}

message CustomsEntryVersion {
  optional string description_of_goods_override = 1;
  optional string ultimate_consignee_tax_id = 2;
  optional google.protobuf.Timestamp entry_date = 3;
  optional EntryType entry_type = 4;
  optional google.type.Money freight_charges = 5;
  optional google.protobuf.Timestamp inbond_date = 6;
  optional string inbond_number = 7;
  optional string overrides = 8; // json object
  optional PaymentType payment_type = 9;
  optional string created_by_user_fid = 10;
  optional string processing_port_fid = 11;
  // Used to populate customs entry's submitted_customs_entry_version_id column, which should be set to the last
  // submitted version's id.
  bool submitted = 12;
}

message PgaStatus {
  PgaAgencyCode agency_code = 1;
  PgaStatusCode status_code = 2;
}

enum CargoReleaseStatus {
  CARGO_RELEASE_STATUS_INVALID = 0;
  CARGO_RELEASE_STATUS_PENDING_INTENSIVE_EXAM = 1;
  CARGO_RELEASE_STATUS_ENTRY_DELETED_BY_CBP = 2;
  CARGO_RELEASE_STATUS_RELEASE_DATE_UPDATE = 3;
  CARGO_RELEASE_STATUS_ENTRY_CANCELLED = 4;
  CARGO_RELEASE_STATUS_ENTRY_CANCELLATION_UNSET = 5;
  CARGO_RELEASE_STATUS_ENTRY_WILL_BE_CANCELLED_IN_7_DAYS = 6;
  CARGO_RELEASE_STATUS_NO_BILL_MATCH_AFTER_30_DAYS = 7;
  CARGO_RELEASE_STATUS_NO_BILL_MATCH_AFTER_60_DAYS = 8;
  CARGO_RELEASE_STATUS_CST_APPROVAL_REQUIRED = 9;
  CARGO_RELEASE_STATUS_NO_CBPF_7501_REQUIRED_FOR_ENT_SUMMARY = 10;
  CARGO_RELEASE_STATUS_QUOTA_PENDING = 11;
  CARGO_RELEASE_STATUS_QUOTA_REJECTED = 12;
  CARGO_RELEASE_STATUS_QUOTA_RESERVED = 13;
  CARGO_RELEASE_STATUS_QUOTA_ACCEPTED = 14;
  CARGO_RELEASE_STATUS_BOL_TYPE_INELIGIBLE_FOR_ENTRY_PROCESSING = 15;
  CARGO_RELEASE_STATUS_POE_REQD_NO_AUTO_DERIVE_POSSIBLE = 16;
  CARGO_RELEASE_STATUS_ACTIVE_ENTRY_SUMMARY_NOT_FOUND = 17;
  CARGO_RELEASE_STATUS_ENTRY_NOT_PERMITTED_AT_REPORTED_PORT = 18;
  CARGO_RELEASE_STATUS_IN_BOND_NUMBER_NOT_ON_FILE = 19;
  CARGO_RELEASE_STATUS_IN_BOND_PORT_DISCREPANCY = 20;
  CARGO_RELEASE_STATUS_SPLIT_SHIPMENT_RELEASE_CODE_REQUIRED = 21;
  CARGO_RELEASE_STATUS_SPLIT_SHIPMENT_RELEASE_PENDING = 22;
  CARGO_RELEASE_STATUS_DOC_REQUIRED_FOR_CORRECTION_REQUEST = 23;
  CARGO_RELEASE_STATUS_DOC_REQUIRED_FOR_CANCELLATION_REQUEST = 24;
  CARGO_RELEASE_STATUS_CORRECTION_REQUEST_REJECTED = 25;
  CARGO_RELEASE_STATUS_CANCELLATION_REQUEST_REJECTED = 26;
  CARGO_RELEASE_STATUS_ENTRY_REPLACED = 27;
  CARGO_RELEASE_STATUS_ENTRY_SUMMARY_PORT_DISCREPANCY = 28;
  CARGO_RELEASE_STATUS_UNDER_CBP_REVIEW = 29;
  CARGO_RELEASE_STATUS_DOCUMENT_REQUIRED = 30;
  CARGO_RELEASE_STATUS_ADMISSIBLE = 31;
  CARGO_RELEASE_STATUS_RELEASED = 32;
  CARGO_RELEASE_STATUS_RELEASE_SUSPENDED = 33;
}

enum EntrySummaryStatus {
  ENTRY_SUMMARY_STATUS_INVALID = 0;
  ENTRY_SUMMARY_STATUS_ACCEPTED = 1;
  ENTRY_SUMMARY_STATUS_PAPERLESS = 2;
  ENTRY_SUMMARY_STATUS_TIB_OPEN = 3;
  ENTRY_SUMMARY_STATUS_DELETED = 4;
  ENTRY_SUMMARY_STATUS_TRANSMITTED = 5;
  ENTRY_SUMMARY_STATUS_ENTRY_DOCS_REQUIRED = 6;
  ENTRY_SUMMARY_STATUS_REJECTED = 7;
  ENTRY_SUMMARY_STATUS_IN_PROGRESS = 8;
  ENTRY_SUMMARY_STATUS_CONSIGNEE_CANCELLED = 9;
  ENTRY_SUMMARY_STATUS_ACCEPTED_CENSUS_WARNING = 10;
  ENTRY_SUMMARY_STATUS_LIQUIDATED = 11;
  ENTRY_SUMMARY_STATUS_NOT_REQUIRED = 12;
}

enum FdaStatus {
  FDA_STATUS_INVALID = 0;
  FDA_STATUS_TRANSMITTED = 1;
  FDA_STATUS_REVIEW = 2;
  FDA_STATUS_HOLD = 3;
  FDA_STATUS_MAY_PROCEED = 4;
  FDA_STATUS_REJECTED = 5;
}

enum InvoicingStatus {
  INVOICING_STATUS_INVALID = 0;
  INVOICING_STATUS_ERROR = 1;
  INVOICING_STATUS_INVOICED = 2;
  INVOICING_STATUS_INVOICED_INCORRECTLY = 3;
  INVOICING_STATUS_RECONCILED = 4;
}

enum ManifestStatus {
  MANIFEST_STATUS_INVALID = 0;
  MANIFEST_STATUS_MANIFEST_HOLD_CBP = 1;
  MANIFEST_STATUS_MANIFEST_HOLD_AGRICULTURE = 2;
  MANIFEST_STATUS_CBP_HOLD = 3;
  MANIFEST_STATUS_CBP_MANIFEST_HOLD_REMOVED = 4;
  MANIFEST_STATUS_AGRICULTURE_MANIFEST_HOLD_REMOVED = 5;
  MANIFEST_STATUS_CBP_HOLD_REMOVED = 6;
  MANIFEST_STATUS_SPLIT_BILL_DOES_NOT_QUALIFY_FOR_RELEASE = 7;
  MANIFEST_STATUS_QTY_MORE_THAN_MANIFESTED_QTY = 8;
  MANIFEST_STATUS_INBOND_DOES_NOT_MATCH_OR_NOT_ON_FILE = 9;
  MANIFEST_STATUS_BILL_DELETED = 10;
  MANIFEST_STATUS_BILL_DELETED_AFTER_ARRIVAL = 11;
  MANIFEST_STATUS_INBOND_DELETED_AFTER_ARRIVAL_AND_RELEASE = 12;
  MANIFEST_STATUS_BOL_TYPE_INELIGIBLE_FOR_ENTRY_PROCESSING = 13;
  MANIFEST_STATUS_NO_BILL_MATCH = 14;
  MANIFEST_STATUS_ACAS_BILL_ON_FILE = 15;
  MANIFEST_STATUS_BILL_ON_FILE = 16;
  MANIFEST_STATUS_BILL_DEPARTED = 17;
  MANIFEST_STATUS_BILL_ARRIVED = 18;
}

enum ReleaseStatus {
  RELEASE_STATUS_INVALID = 0;
  RELEASE_STATUS_TRANSMITTED = 1;
  RELEASE_STATUS_RELEASE_GEN_EXAM = 2;
  RELEASE_STATUS_RELEASE_DOC_REVIEW = 3;
  RELEASE_STATUS_PENDING_INTENSIVE_EXAM = 4;
  RELEASE_STATUS_INTENSIVE_EXAM_COMPLETE = 5;
  RELEASE_STATUS_PAPERLESS = 6;
  RELEASE_STATUS_ENTRY_DOCS_REQUIRED = 7;
  RELEASE_STATUS_OVERRIDE_TO_GENERAL = 8;
  RELEASE_STATUS_ENTRY_DATE_UPDATE = 9;
  RELEASE_STATUS_ENTRY_CANCELLED = 10;
  RELEASE_STATUS_ENTRY_CANCELLATION_UNSET = 11;
  RELEASE_STATUS_IN_BOND_NUMBER_NOT_ON_FILE = 12;
  RELEASE_STATUS_IN_BOND_PORT_DISCREPANCY = 13;
  RELEASE_STATUS_SPLIT_SHIPMENT_RELEASE_CODE_REQUIRED = 14;
  RELEASE_STATUS_SPLIT_SHIPMENT_RELEASE_PENDING = 15;
  RELEASE_STATUS_DOC_REQUIRED_FOR_CORRECTION_REQUEST = 16;
  RELEASE_STATUS_DOC_REQUIRED_FOR_CANCELLATION_REQUEST = 17;
  RELEASE_STATUS_CORRECTION_REQUEST_REJECTED = 18;
  RELEASE_STATUS_CANCELLATION_REQUEST_REJECTED = 19;
  RELEASE_STATUS_ENTRY_REPLACED = 20;
  RELEASE_STATUS_ENTRY_PORT_DISCREPANCY = 21;
  RELEASE_STATUS_UNDER_CBP_REVIEW = 22;
  RELEASE_STATUS_DOCUMENT_REQUIRED = 23;
  RELEASE_STATUS_ADMISSIBLE = 24;
  RELEASE_STATUS_RELEASED = 25;
  RELEASE_STATUS_RELEASE_SUSPENDED = 26;
  RELEASE_STATUS_CERTIFIED = 27;
  RELEASE_STATUS_REJECTED = 28;
}

enum TransmitToNetchbReason {
  TRANSMIT_TO_NETCHB_REASON_INVALID = 0;
  TRANSMIT_TO_NETCHB_REASON_ANTI_DUMPING_DUTIES = 1;
  TRANSMIT_TO_NETCHB_REASON_COUNTERVAILING_DUTIES = 2;
  TRANSMIT_TO_NETCHB_REASON_PARTNER_GOVERNMENT_AGENCY = 3;
  TRANSMIT_TO_NETCHB_REASON_SPECIAL_PROGRAM_INDICATOR = 4;
  TRANSMIT_TO_NETCHB_REASON_RELATED_PARTIES = 5;
  TRANSMIT_TO_NETCHB_REASON_PRORATIONS = 6;
  TRANSMIT_TO_NETCHB_REASON_MULTIPLE_CUSTOMS_ENTRIES = 7;
  TRANSMIT_TO_NETCHB_REASON_COTTON_FEE = 8;
  TRANSMIT_TO_NETCHB_REASON_OTHER_FEES = 9;
  TRANSMIT_TO_NETCHB_REASON_CENSUS_WARNINGS = 10;
  TRANSMIT_TO_NETCHB_REASON_ISF_NOT_FILED = 11;
  TRANSMIT_TO_NETCHB_REASON_ELECTRONIC_DOCUMENTS_REQUIRED = 12;
  TRANSMIT_TO_NETCHB_REASON_SPLIT_SHIPMENT = 13;
  TRANSMIT_TO_NETCHB_REASON_NO_BILL_MATCH_NETCHB = 14;
  TRANSMIT_TO_NETCHB_REASON_QUANTITY_GREATER_THAN_MANIFEST = 15;
  TRANSMIT_TO_NETCHB_REASON_INCORRECT_MID = 16;
  TRANSMIT_TO_NETCHB_REASON_RAIL_SHIPMENT = 17;
}

enum EntryType {
  ENTRY_TYPE_INVALID = 0;
  ENTRY_TYPE_CONSUMPTION_CATEGORY = 1;
  ENTRY_TYPE_CONSUMPTION_FREE_AND_DUTIABLE = 2;
  ENTRY_TYPE_CONSUMPTION_QUOTE_VISA = 3;
  ENTRY_TYPE_CONSUMPTION_ADD_CVD = 4;
  ENTRY_TYPE_APPRAISEMENT = 5;
  ENTRY_TYPE_VESSEL_REPAIR = 6;
  ENTRY_TYPE_CONSUMPTION_FOREIGN_TRADE_ZONE = 7;
  ENTRY_TYPE_CONSUMPTION_ADD_CVD_AND_QUOTE_VISA = 8;
  ENTRY_TYPE_NAFTA_DUTY_DEFERRAL = 9;
  ENTRY_TYPE_RECONCILIATION_SUMMARY = 10;
  ENTRY_TYPE_INFORMAL_CATEGORY = 11;
  ENTRY_TYPE_INFORMAL_FREE_AND_DUTIABLE = 12;
  ENTRY_TYPE_INFORMAL_QUOTE_VISA = 13;
  ENTRY_TYPE_WAREHOUSE_CATEGORY = 14;
  ENTRY_TYPE_WAREHOUSE = 15;
  ENTRY_TYPE_RE_WAREHOUSE = 16;
  ENTRY_TYPE_TEMPORARY_IMPORTATION_BOND = 17;
  ENTRY_TYPE_TRADE_FAIR = 18;
  ENTRY_TYPE_PERMANENT_EXHIBITION = 19;
  ENTRY_TYPE_WAREHOUSE_FTZ_ADMISSION = 20;
  ENTRY_TYPE_WAREHOUSE_WITHDRAWAL_CATEGORY = 21;
  ENTRY_TYPE_WAREHOUSE_WITHDRAWAL_CONSUMPTION = 22;
  ENTRY_TYPE_WAREHOUSE_WITHDRAWAL_QUOTE = 23;
  ENTRY_TYPE_AIRCRAFT_AND_VESSEL_SUPPLY = 24;
  ENTRY_TYPE_WAREHOUSE_WITHDRAWAL_ADD_CVD = 25;
  ENTRY_TYPE_WAREHOUSE_WITHDRAWAL_ADD_CVD_AND_QUOTE_VISA = 26;
  ENTRY_TYPE_DRAWBACK_CATEGORY = 27;
  ENTRY_TYPE_DIRECT_IDENTIFICATION_MANUFACTURING_DRAWBACK = 28;
  ENTRY_TYPE_DIRECT_IDENTIFICATION_UNUSED_MERCHANDISE_DRAWBACK = 29;
  ENTRY_TYPE_REJECTED_MERCHANDISE_DRAWBACK = 30;
  ENTRY_TYPE_SUBSTITUTION_MANUFACTURER_DRAWBACK = 31;
  ENTRY_TYPE_SUBSTITUTION_UNUSED_MARCHANDISE_DRAWBACK = 32;
  ENTRY_TYPE_OTHER_DRAWBACK = 33;
  ENTRY_TYPE_GOVERNMENT_CATEGORY = 34;
  ENTRY_TYPE_DEFENSE_CONTRACT_ADMINISTRATION_SERVICE_REGION = 35;
  ENTRY_TYPE_GOVERNMENT_DUTIABLE = 36;
  ENTRY_TYPE_TRANSPORTATION_CATEGORY = 37;
  ENTRY_TYPE_IMMEDIATE_TRANSPORTATION = 38;
  ENTRY_TYPE_TRANSPORTATION_AND_EXPORTATION = 39;
  ENTRY_TYPE_IMMEDIATE_EXPORTATION = 40;
  ENTRY_TYPE_BARGE_MOVEMENT = 41;
  ENTRY_TYPE_PERMIT_TO_PROCEED = 42;
  ENTRY_TYPE_BAGGAGE = 43;
  ENTRY_TYPE_SECTION_321 = 44;
}

enum PaymentType {
  PAYMENT_TYPE_INVALID = 0;
  PAYMENT_TYPE_NOT_REQUIRED = 1;
  PAYMENT_TYPE_NON_STATEMENT = 2;
  PAYMENT_TYPE_STATEMENT_GROUP_BY_BROKER_FILER_CODE = 3;
  PAYMENT_TYPE_SEPARATE_STATEMENT_FOR_IMPORTER_OF_RECORD = 4;
  PAYMENT_TYPE_SEPARATE_STATEMENT_FOR_IMPORTER_SUBDIVISION = 5;
  PAYMENT_TYPE_PERIODIC_STATEMENT_BY_BROKER_FILER_CODE = 6;
  PAYMENT_TYPE_PERIODIC_STATEMENT_FOR_IMPORTER_OF_RECORD = 7;
  PAYMENT_TYPE_PERIODIC_STATEMENT_FOR_IMPORTER_SUBDIVISION = 8;
}

enum PgaAgencyCode {
  PGA_AGENCY_CODE_INVALID = 0;
  PGA_AGENCY_CODE_FDA = 1;
  PGA_AGENCY_CODE_EPA = 2;
  PGA_AGENCY_CODE_APH = 3;
  PGA_AGENCY_CODE_CPS = 4;
  PGA_AGENCY_CODE_NHT = 5;
  PGA_AGENCY_CODE_FWS = 6;
  PGA_AGENCY_CODE_FSI = 7;
  PGA_AGENCY_CODE_AMS = 8;
}

enum PgaStatusCode {
  PGA_STATUS_CODE_INVALID = 0;
  PGA_STATUS_CODE_TRANSMITTED = 1;
  PGA_STATUS_CODE_REVIEW = 2;
  PGA_STATUS_CODE_HOLD = 3;
  PGA_STATUS_CODE_REJECTED = 4;
  PGA_STATUS_CODE_MAY_PROCEED = 5;
}

message V2ToV1IdMapping {
  repeated CustomsEntryMapping customs_entry_mapping = 1;
  message CustomsEntryMapping {
    string v1_customs_entry_fid = 1;
    string v2_filing_fid = 2;
  }
}

message WritebackCustomsEntriesRequest {
  string shipment_fid = 1;
  // The customs filing order for which this work is performed
  string customs_filing_order_fid = 2;
  // All customs entries for the shipment
  repeated CustomsEntry customs_entries = 11;
}

message WritebackCustomsEntriesResponse {
  V2ToV1IdMapping id_mapping = 1;
}

message UnenrollCustomsEntriesRequest {
  string shipment_fid = 1;
  string customs_filing_order_fid = 2;
}

message UnenrollCustomsEntriesResponse {
  V2ToV1IdMapping id_mapping = 1;
}
