// TEAM: origin_ops

syntax = "proto3";

package flexport.monolith.exceptions.exception.v1;

import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";

option java_multiple_files = true;
option java_outer_classname = "ExceptionRevisionEntityProto";
option java_package = "com.flexport.monolith.exceptions.exception.v1";
option ruby_package = "Flexport::Monolith::Exceptions::Exception::V1";

// Exception Revision record.
// See https://flexport.atlassian.net/wiki/spaces/EN/pages/1206912059/Exceptions+data+ingestion+into+data+lake+warehouse+WIP .
message ExceptionRevisionEntity {
  string fid = 1;
  int64 id = 2;
  // This is the exception uuid, which must be called id in proto. The db id for Exception is not used in proto
  string exception_id = 3;
  string exception_type_fid = 4;
  string status = 5;
  string severity = 6;
  google.protobuf.StringValue message = 7;
  google.protobuf.StringValue internal_note = 8;
  google.protobuf.Int32Value estimated_transit_time_impact = 9;
  google.protobuf.Timestamp due_date_time = 10;
  ResolutionType resolution_type = 11;
  google.protobuf.StringValue root_cause_fid = 12;
  google.protobuf.Timestamp occurence_time = 13;
  // The source db field is jsonb - type discussion of using Struct vs Value field:
  // - https://github.flexport.io/flexport/flexport/tree/master/slack_messages/C029DG26A_1600672621.028900.md
  google.protobuf.Struct domain_specific_info = 14;
  string updated_by_user_fid = 15;
  google.protobuf.StringValue assigned_user_fid = 16;
  google.protobuf.StringValue assigned_team_fid = 17;
  repeated string notify_teams_fids = 18;
  google.protobuf.Timestamp created_at_time = 19;
  google.protobuf.Timestamp updated_at_time = 20;
  google.protobuf.Timestamp resolved_at_time = 21;
  google.protobuf.StringValue exception_type_slug = 22;
  google.protobuf.StringValue root_cause_slug = 23;
  google.protobuf.StringValue assigned_team_slug = 24;
  repeated string notify_teams_slugs = 25;
  google.protobuf.Timestamp actual_resolved_at_time = 26;
  string container_fid = 27;
}

// See engines/exceptions/app/services/exceptions/exception_type.rb#VALID_RESOLUTION_TYPES
enum ResolutionType {
  RESOLUTION_TYPE_INVALID = 0;
  RESOLUTION_TYPE_ACTION_REQUIRED = 1;
  RESOLUTION_TYPE_NO_ACTION_REQUIRED = 2;
}
