// TEAM: customs_platform

syntax = "proto3";

package flexport.customs.productlibrary.products.v1beta1;

import "flexport/customs/productlibrary/common/v1beta1/country_code.proto";
import "flexport/customs/productlibrary/products/productcountryspecific/us/v1beta1/product_us_specific.proto";
import "flexport/customs/productlibrary/products/v1beta1/tariff.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";

option java_multiple_files = true;
option java_outer_classname = "ProductProto";
option java_package = "com.flexport.customs.productlibrary.products.v1beta1";
option ruby_package = "Flexport::Customs::ProductLibrary::Products::V1Beta1";

// This proto defines a product with a context.
message ProductWithContext {
  // The ProductContext is a set of fields that are used to identify the countries of product like COO, COI, COE
  ProductContext context = 1;

  // The product is a set of fields that are used to identify the product itself like HS code, description, etc.
  Product product = 2;
}

message ProductContext {
  reserved 4;

  flexport.customs.productlibrary.common.v1beta1.CountryCode country_of_import = 1;
  flexport.customs.productlibrary.common.v1beta1.CountryCode country_of_origin = 2;
  flexport.customs.productlibrary.common.v1beta1.CountryCode country_of_export = 3;
}

// A "Product" is a "Product With Context" minus the "context" party.
// Unless looking at only top-level fields like SKU or description, It must be considered together with an associated
// context as defined by a ProductContext.
message Product {
  string product_fid = 1;
  string sku = 2;
  string description = 3;
  string client_fid = 4;
  repeated ProductProperty properties = 7;

  // Why there may be multiple Tariffs:
  // - Products like watches that have separate tariffs for different parts
  // - Sets made up of multiple (possibly unrelated) items
  repeated Tariff tariff_info = 5;

  repeated ProductCountrySpecific country_specific_infos = 8;
  string name = 9;
  message ProductCountrySpecific {
    oneof info {
      flexport.customs.productlibrary.products.productcountryspecific.us.v1beta1.ProductUsSpecific us_specific = 1;
    }
  }

  repeated ProductCondition conditions = 6;
  message ProductCondition {
    // Following is based on the ADR-1 spec:
    // https://github.flexport.io/flexport/customs-adr/blob/main/decisions/accepted/0001-validations-conditions-escalations.md
    // The above link explains the fields in ProductCondition.
    enum ProductConditionType {
      reserved 1, 6, 7;

      PRODUCT_CONDITION_TYPE_INVALID = 0;
      PRODUCT_CONDITION_TYPE_CLASSIFICATION_MISSING = 8;
      PRODUCT_CONDITION_TYPE_COTTON_FEE_INCOMPLETE = 3;

      PRODUCT_CONDITION_TYPE_SPECIAL_TARIFFS_301_INCOMPLETE = 2;
      PRODUCT_CONDITION_TYPE_FDA_PROFILE_INCOMPLETE = 4;
      PRODUCT_CONDITION_TYPE_EPA_PROFILE_INCOMPLETE = 5;
    }

    google.protobuf.BoolValue status = 1;
    ProductConditionType condition_type = 2;
    string reason = 3;
    optional string message = 4;
    google.protobuf.Timestamp last_evaluated = 5;

    oneof context {
      ClassificationMissingContext classification_missing_context = 101;
      CottonFeeIncompleteContext cotton_fee_incomplete_context = 102;
    }

    message ClassificationMissingContext {
      flexport.customs.productlibrary.common.v1beta1.CountryCode country_of_import = 1;
      flexport.customs.productlibrary.common.v1beta1.CountryCode country_of_origin = 2;
      ClassificationMissingReason reason = 3;
      ClassificationActor actor = 4;
    }

    enum ClassificationMissingReason {
      CLASSIFICATION_MISSING_REASON_INVALID = 0;
      CLASSIFICATION_MISSING_REASON_CLASSIFICATION_INCOMPLETE = 1;
      CLASSIFICATION_MISSING_REASON_CLASSIFICATION_MORE_INFO_NEEDED = 2;
      CLASSIFICATION_MISSING_REASON_CLASSIFICATION_PENDING_AUDIT = 3;
    }

    message CottonFeeIncompleteContext {
      flexport.customs.productlibrary.common.v1beta1.CountryCode country_of_import = 1;
    }
  }
}

enum ClassificationActor {
  CLASSIFICATION_ACTOR_INVALID = 0;
  CLASSIFICATION_ACTOR_FLEXPORT_INTERNAL = 1;
  CLASSIFICATION_ACTOR_AVALARA = 2;
}

message ProductProperty {
  string name = 1;
  string value = 2;
}
